<!DOCTYPE html>
<html lang="en">
	<head>
		{% load staticfiles %}
		<script src="{% static 'js/jquery-1.11.2.min.js' %}"></script>
		<script>
			//variables
			
			//Events
			$(document).ready(function() {
				$("#foot").load("{% url 'footer' %}");
				$("#head").load("{% url 'headerDriver' %}");
				$("#btnCreateTask").click(function() {		
					return permissionCreateTask("{{csrf_token}}", "{% url 'validatePermission' %}", "");// true or false
				});

				getPendingTask("{{ csrf_token }}", "{% url 'retrievePendingTask' %}");
			});
			
			//Functions
			function getPendingTask(token, url) {

				$.ajax({
					method : "POST",
					url : url,
					data : {
						"csrfmiddlewaretoken" : token,
						"N" : 3
					},
					datatype : "json",
					success : function(data, status, xhr) {
						for (var i = 1; i < 4; i++) {
							if(i == 1){
								$("#divStartNow").attr("href", "{% url 'startTask'%}?task_id=" + data[i].task_id);
							}
							$("#next" + i + " .machineModel").html(data[i].qr_code);
							$("#next" + i + " .fieldName").html(data[i].field);
							$("#next" + i + " .category").html(data[i].category);
						};
					}
				});
			}
			function permissionCreateTask(token, url, permission){			
				$.ajax({
					method: "POST",
					url: url,
					dataType: "json", 
					async: false,
       				data: {"csrfmiddlewaretoken" : token},
					success: function(data, status, xhr)
					{					 	
					 	if(!data.authorized)
					 	{	
					 		alert("You do not have enough right to create a task!!");
					 	}
					 		permission = data.authorized;
					}
				});
					return permission; 
			}
		</script>
	</head>
	<body>
		<header id="head"></header>
		<div id="wrapper">
			<div id="content">
				<div class="namePage">
					<img src="{% static 'imgSmall/clock.png' %}"/>
					HC TASKFLOW
				</div>
				<div id="divTask">
					Scheduled Tasks
					<div class="row">
						<div class="col-xs-4 col-md-4 nextBox" id="next1">
							<span class="titleNextTask"><h2>#1</h2></span>
							<h2><span class="machineModel">></span></h2>
							<h3>Field</h3><h4><span class="fieldName"></span></h4>
							<a href="#" id="moreInfo">More Info</a>
						</div>
						<div class="col-xs-4 col-md-4 nextBox" id="next2">
							<span class="titleNextTask"><h2>#1</h2></span>
							<h2><span class="machineModel">></span></h2>
							<h3>Field</h3><h4><span class="fieldName"></span></h4>
							<a href="#" id="moreInfo">More Info</a>
						</div>
						<div class="col-xs-4 col-md-4 nextBox" id="next3">
							<span class="titleNextTask"><h2>#1</h2></span>
							<h2><span class="machineModel">></span></h2>
							<h3>Field</h3><h4><span class="fieldName"></span></h4>
							<a href="#" id="moreInfo">More Info</a>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-4 col-md-4 colTasks">
							<a href="{% url 'pastTasks' %}">
							<input type="button" id="btnPastTasks" class="btnsTasks"/>
							</a>
						</div>
						<div class="col-xs-4 col-md-4 colTasks">
						</div>
						<div class="col-xs-4 col-md-4 colTasks">
							<a href="{% url 'createTask' %}">
							<input type="button" id="btnCreateTask" class="btnsTasks"/>
							</a>
						</div>
					</div>
				</div>
			</div>
			<div id="clearBoth"></div>
		</div>
		<footer id="foot"></footer>
	</body>
</html>
