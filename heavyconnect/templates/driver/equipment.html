<!DOCTYPE html>
<html lang="en">
	<head>
		{% load staticfiles %}
		{% load i18n %}
		<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script src="https://maps.googleapis.com/maps/api/js"></script>
		<script src="//maps.googleapis.com/maps/api/js?v=3.exp&sensor=true"></script>
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>
		<script src="{% static 'js/jquery-1.11.2.min.js' %}"></script>
		<script src="{% static 'js/script.js' %}"></script>
		<script>
			//MAPS FUNCTION BEGIN
			var x = document.getElementById("demo");
			function getLocation() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showPosition, showError);
				} else {
					x.innerHTML = "Geolocalização não é suportada nesse browser.";
				}
			}

			function showPosition(position) {
				var lat = position.coords.latitude;
				var lon = position.coords.longitude;
				latlon = new google.maps.LatLng(lat, lon)
				mapholder = document.getElementById('mapholder')

				var myOptions = {
					center : latlon,
					zoom : 17,
					mapTypeId : google.maps.MapTypeId.ROADMAP,
					mapTypeControl : false,
					navigationControlOptions : {
						style : google.maps.NavigationControlStyle.SMALL
					}
				};
				var map = new google.maps.Map(document.getElementById("mapholder"), myOptions);
				var marker = new google.maps.Marker({
					position : latlon,
					map : map,
				});
			}

			function showError(error) {
				switch(error.code) {
				case error.PERMISSION_DENIED:
					x.innerHTML = "Usuário rejeitou a solicitação de Geolocalização."
					break;
				case error.POSITION_UNAVAILABLE:
					x.innerHTML = "Localização indisponível."
					break;
				case error.TIMEOUT:
					x.innerHTML = "O tempo da requisição expirou."
					break;
				case error.UNKNOWN_ERROR:
					x.innerHTML = "Algum erro desconhecido aconteceu."
					break;
				}
			}

			//MAPS FUNCTION END

			//variables

			//Events
			$(document).ready(function() {
				var item = {};
				// Stores url's parameters

				$("#foot").load("{% url 'footer' %}");
				$("#head").load("{% url 'headerDriver' %}");

				getLocation();
				item = getParametersUrl();
				$("#qr_code").html(item.qr_code);

				loadEquipmentInfo("{{ csrf_token }}", "{% url 'getEquipmentInfo' %}", item.qr_code);
				loadEquipmentStatus("{{ csrf_token }}", "{% url 'equipmentStatus' %}", item.qr_code);
				//Broken

				$("#btnTractor").click(function() {
					$('#showImgModal').modal();
				});

			});
			//Functions
			function loadEquipmentInfo(token, url, id) {
				$.ajax({
					method : "POST",
					url : url,
					data : {
						"csrfmiddlewaretoken" : token,
						"qr_code" : id
					}, // id could be qrCode or employeeId
					datatype : "json",
					success : function(data, status, xhr) {
						if (data.success) {
							$("#nickname").html(data.nickname);
							$("#asset_number").html(data.asset_number);
							$("#manufacturer").html(data.manufacturer);
							$("#model").html(data.model);
							$("#hours_cost").html(data.hour_cost);
							$("#hp").html(data.horse_power);
							$("#serial_number").html(data.serial_number);
							$("#hitch_sz").html(data.hitch_capacity);
							$("#drawn_size").html(data.drawbar_category);
							$("#acquired_date").html(data.year_purchased);
						}
					}
				});
			}

			function loadEquipmentStatus(token, url, id) {
				$.ajax({
					method : "POST",
					url : url,
					data : {
						"csrfmiddlewaretoken" : token,
						"qr_code" : id
					}, // id could be qrCode or employeeId
					datatype : "json",
					success : function(data, status, xhr) {
						if (data.success) {
							if (data["status"] == 1) {// status Ok
								changeColorStatus("btnStatus1", "btnStatus2", "btnStatus3");
							} else if (data["status"] == 2) {// Status Attention
								changeColorStatus("btnStatus2", "btnStatus1", "btnStatus3");
							} else {// status Broken
								changeColorStatus("btnStatus3", "btnStatus2", "btnStatus1");
							}
						}
					}
				});
			}

			function changeColorStatus(btn1, btn2, btn3) {
				$("#" + btn2).css("background-color", "#666");
				$("#" + btn3).css("background-color", "#666");
				$("#" + btn1).css("border-bottom", "solid 2px #434300");
				$("#" + btn2).css("border-bottom", "solid 2px #434300");
				$("#" + btn3).css("border-bottom", "solid 2px #434300");
			}
		</script>
	</head>
	<body>
		<header id="head"></header>
		<div id="wrapper">
			<div id="content" class="divEquip">
				{% trans 'TRACTOR' %}: <span id="nickname"></span>
				<div class="row rowUpEquip">
					<div class="col-xs-3 col-md-3" id="colBtnsEquip">
						{% trans 'Status' %}:
						<a href="{% url 'home' %}">
						<input type="button" id="btnOk" class="btnStatusEquip" value="{% trans 'OK - Ready to work' %}"/>
						</a>
						<a href="{% url 'home' %}">
						<input type="button" id="btnService" class="btnStatusEquip" value="{% trans 'SERVICE Needed' %}"/>
						</a>
						<a href="{% url 'home' %}">
						<input type="button" id="btnBroken" class="btnStatusEquip" value="{% trans 'BROKEN! Do not use' %}"/>
						</a>
					</div>
					<div class="col-xs-3 col-md-3" id="colNoteEquip">
						{% trans 'Notes' %}:
						<br>
						<textarea rows="2" cols="2" form="notesSubmit" id="notesEquip"></textarea>
					</div>
					<div class="col-xs-6 col-md-6" id="colSpecEquip">
						{% trans 'QR Sticker' %}: <span id="qr_code"></span>
						<br>
						{% trans 'Reiter Asset' %}: <span id="asset_number"></span>
						<br>
						{% trans 'Manufacturer' %}: <span id="manufacturer"></span>
						<br>
						{% trans 'Model' %}: <span id="model"></span>
						<br>
						{% trans 'Hours' %}: <span id="hours_cost"></span>
						<br>
						{% trans 'Horse Power' %}: <span id="hp"></span>
					</div>
				</div>
				<div class="row rowDownEquip">
					<div class="col-xs-6 col-md-6" id="colMapHolder">
						<div class="map" id="mapholder"></div>
					</div>
					<div class="col-xs-2 col-md-2" id="colSpecImg1">
						<a href="{% url 'home' %}">
							<input type="button" class="divSpecImg" id="btnSpecs" value="{% trans 'SPEC' %}"/>
						</a>
					</div>
					<div class="col-xs-2 col-md-2" id="colSpecImg2">
						<a href="{% url 'home' %">
							<a href="#"> <img src="{% static 'imgSmall/buttons/tractor.png' %}" id="btnTractor"/> </a>
						</a>
					</div>
					<div class="col-xs-2 col-md-2" id="colSpecImg3">
						<a href="{% url 'home' %}">
							<input type="button" class="divSpecImg" id="btnAddImg" value="{% trans 'ADD IMAGE' %}"/>
						</a>
					</div>	
						
					</div>
				</div>
			</div>
			<div id="clearBoth"></div>
			<!-- MODAL OF EQUIPMENT -->
			<div class="modal fade" id="showImgModal" role="dialog">
				<div class="modal-dialog">
					<!-- Modal content-->
					<div class="modal-content modalEquip">
						<button type="button" class="closeEquip" data-dismiss="modal"></button>
						<div class="modal-body" id="slideModalEquip">
							<div id="myCarousel" class="carousel slide" data-ride="carousel">
								<!-- Indicators -->
								<ol class="carousel-indicators">
									<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
									<li data-target="#myCarousel" data-slide-to="1"></li>
									<li data-target="#myCarousel" data-slide-to="2"></li>
								</ol>
								<div class="carousel-inner" role="listbox">
									<div class="item active">
										<img src="{% static 'imgSmall/buttons/tractor.png' %}" id="img1" alt="img1" class="imgsEquip"/>
									</div>

									<div class="item">
										<img src="{% static 'imgSmall/buttons/specs.png' %}" id="img2" alt="img2" class="imgsEquip"/>
									</div>

									<div class="item">
										<img src="{% static 'imgSmall/buttons/addImage.png' %}" id="img3" alt="img3" class="imgsEquip"/>
									</div>
								</div>
								<a class="left carousel-control controlModalEquip" href="#myCarousel" role="button" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> <span class="sr-only">Previous</span> </a>
								<a class="right carousel-control controlModalEquip" href="#myCarousel" role="button" data-slide="next"> <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> <span class="sr-only">Next</span> </a>
							</div>

						</div>
						<div class="both"></div>
					</div>
				</div>
			</div>
		</div>
		<footer id="foot"></footer>
	</body>
</html>