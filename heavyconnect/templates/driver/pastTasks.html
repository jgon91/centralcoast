<!DOCTYPE html>
<html lang="en">
	<head>
		{% load staticfiles %}
		<script src="{% static 'js/jquery-1.11.2.min.js' %}"></script>
		<link rel="stylesheet" type="text/css" href="{% static 'css/styleSmall.css' %}">
		<script>

			$(document).ready(function() {
				$("#foot").load("{% url 'footer' %}");
				$("#head").load("{% url 'headerDriver' %}");

				var offset = 0;

				getLastTasks("{{csrf_token}}", "{% url 'pastTaskList' %}", offset, false, 7);	

				$("#btnBack").click(function(){
					offset = upgradePastBox(this.id, offset, 7);
				});

				$("#btnForward").click(function(){
					offset = upgradePastBox(this.id, offset, 7);
				});

			});

			function upgradePastBox(btn, offset, limit) {
				$(".pastBox").fadeOut(1000);
				$(".dateTasks").fadeOut(1000);
				
				if(btn == "btnBack" && offset >= 0){
					offset++;
					getLastTasks("{{csrf_token}}", "{% url 'pastTaskList' %}", offset, true, 7);
				}else if(btn == "btnForward" && offset >= 2){ 
					offset -= 2;
					getLastTasks("{{csrf_token}}", "{% url 'pastTaskList' %}", offset, true, 7);
				}else{
					alert("There is no past task to be displayed");
				}
				$(".dateTasks").fadeIn(3000);
				$(".pastBox").fadeIn(3000);

				return offset;
			}

			function getLastTasks(token, url, offset, async, limit) {			
			//alert(offset);	
				$.ajax({
					method: "POST",
					url: url,
					async: async,
					data: {"csrfmiddlewaretoken": token, "offset": offset, "limit": limit},
					datatype: "json",
					success: function(data, status, xhr){		
						//alert(data.length);	
						if(offset < limit){
							$("#btnBack").attr("disabled", false);
						}
						if(offset >= (limit-1)){
							alert("There is no past task to be displayed");
							$("#btnBack").attr("disabled", true);
						}
						else{
							var months = ["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sep","Oct","Nov","Dec"];
							for (var i = 1; i < 3; i++) 
							{
								$("#task" + i + " .hour").html(formatAMPM(data[i].date));
								$("#task" + i + " .date").html(data[i].date.substring(8,10) + " " +months[parseInt(data[i].date.substring(6, 7))].toUpperCase());
								$("#past" + i + " .field").html(data[i].field);
								$("#past" + i + " .category").html(data[i].category);
								$("#past" + i + " .machine").html(data[i].machine_model);
								$("#past" + i + " .task").html(data[i].description);
								$("#past" + i + " .duration").html(data[i].duration + " Hours");
								$("#past" + i + " .implement").html(data[i].implement_model);
								$("#past" + i + " .task_id").html(data[i].task_id);
							}
						}
						
					}
				});			
			}

			function formatAMPM(date) {
				var d = new Date(date);
				var hours = d.getHours();
				var minutes = d.getMinutes();
				var ampm = hours >= 12 ? 'PM' : 'AM';
				hours = hours % 12;
				hours = hours ? hours : 12; // the hour '0' should be '12'
				minutes = minutes < 10 ? '0'+minutes : minutes;
				var strTime = hours + ':' + minutes + ' ' + ampm;
				return strTime;
			}

		</script>
		<style>
			#past1 .task_id, #past2 .task_id
			{
				display: none;
			}
		</style>
	</head>
	<body>
		<header id="head"></header>
		<div id="wrapper">
			<div id="content">
				<div class="namePage" style="padding-top: 15px;">
					HC PAST TASKS
				</div></br></br>
				<div id="divPast">
					<div class="row">
						<div class="col-xs-4 col-md-4 dateTasks">
							<div id="task1">
								<span class="date"></span>
								<span class="hour"></span>
							</div>
						</div>
						<div class="col-xs-4 col-md-4 dateTasks">
							<div id="task2">
								<span class="date"></span>
								<span class="hour"></span>
							</div>
						</div>
					</div>
					<div class="row" style="margin: 0px;">
						<div class="col-xs-2 col-md-2 btnPastTasks">
							<input type="button" id="btnBack" value="B" class="btnBackAdv">
						</div>
						<div class="col-xs-4 col-md-4 pastBox" id="past1">
							MACHINE: <span class="machine"></span>
							</br>IMPLEMENT: <span class="implement" ></span>
							</br>FIELD: <span class="field" ></span>
							</br>TASK: <span class="task"></span>
							</br>CATEGORY: <span class="category"></span>
							</br>DURATION: <span class="duration"></span>
							<span class="task_id"></span>
						</div>
						<div class="col-xs-4 col-md-4 pastBox" id="past2">
							MACHINE: <span class="machine"></span>
							</br>IMPLEMENT: <span class="implement" ></span>
							</br>FIELD: <span class="field" ></span>
							</br>TASK: <span class="task"></span>
							</br>CATEGORY: <span class="category"></span>
							</br>DURATION: <span class="duration"></span>
							<span class="task_id"></span>
						</div>
						<div class="col-xs-2 col-md-2 btnPastTasks">
							<input type="button" id="btnForward" value="A" class="btnBackAdv">
						</div>
					</div>
					<div class="row">
						<div class="col-xs-2 col-md-2 blockBtnReturn">
							<div><a href="{% url 'taskFlow' %}"><input type="button" id="btnReturn" value="" /></a></div>
						</div>
					</div>
				</div>
			</div>
			<div id="clearBoth"></div>
		</div>
		<footer id="foot"></footer>
	</body>
</html>
